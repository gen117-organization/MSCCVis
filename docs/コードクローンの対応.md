# コードクローンの対応
行の対応を元に「予測」を立てて算出する．予測と完全一致なら確定，完全一致でなければ開始行と終了行を探す．
```python
    for child_clone_set in child_clonesets:
        child_clone_id = child_clone_set["clone_id"]
        for index, child_fragment in enumerate(child_clone_set["fragments"]):
            child_fragment_path = child_filemap.get_file_path(child_fragment["file_id"])
            # ファイル名一致のパターンしか対応しないため，pathは一緒であるが一応明示しておく．
            parent_fragment_path = child_fragment_path
            child_start_line = child_fragment["start_line"]
            child_end_line = child_fragment["end_line"]
            # 親コミットのクローンの開始行と終了行を予測
            predict_parent_start_line = corresponded_lines.get_parent_line(child_fragment_path, child_start_line)
            predict_parent_end_line = corresponded_lines.get_parent_line(child_fragment_path, child_end_line)
            # 無いときは確実に新規追加フラグメントなのでNoneにする．
            if child_fragment_path not in parent_clone_map.keys():
                if child_clone_id not in corresponded_fragments.keys():
                    corresponded_fragments[child_clone_id] = {}
                corresponded_fragments[child_clone_id][index] = None
                continue
            for parent_file_fragment in parent_clone_map[child_fragment_path]:
                # 親コミットのクローンの開始行と終了行が予測と一致しているものは確定
                if (parent_file_fragment["start_line"] == predict_parent_start_line) and (parent_file_fragment["end_line"] == predict_parent_end_line):
                    if child_clone_id not in corresponded_fragments.keys():
                        corresponded_fragments[child_clone_id] = {}
                    corresponded_fragments[child_clone_id][index] = (parent_file_fragment["clone_id"], parent_file_fragment["index"])
                    break
                predict_parent_fragment_loc = corresponded_lines.get_fragment_loc_of_parent(child_fragment_path, child_start_line, child_end_line)
                # 親コミットのクローンの行数が0のものは新しく作成されたクローンなのでNone
                if predict_parent_fragment_loc == 0:
                    if child_clone_id not in corresponded_fragments.keys():
                        corresponded_fragments[child_clone_id] = {}
                    corresponded_fragments[child_clone_id][index] = None
                    break
                # 完全一致はすでに対応させている．
                if (parent_file_fragment["end_line"] - parent_file_fragment["start_line"] + 1) == (child_end_line - child_start_line + 1):
                    continue
                # 子コミットの方が行数が多いパターンは子コミットのコード片の先頭または末尾に挿入されているので，親コミットの行番号を探す．
                if (parent_file_fragment["end_line"] - parent_file_fragment["start_line"] + 1) < (child_end_line - child_start_line + 1):
                    parent_start_line = -1
                    for l in range(child_start_line, child_end_line+1):
                        if corresponded_lines.get_parent_line(child_fragment_path, l) is None:
                            continue
                        if corresponded_lines.get_parent_line(child_fragment_path, l) == parent_file_fragment["start_line"]:
                            parent_start_line = parent_file_fragment["start_line"]
                            break
                    if parent_start_line == -1:
                        continue
                    parent_end_line = -1
                    for l in reversed(range(child_start_line, child_end_line+1)):
                        if corresponded_lines.get_parent_line(child_fragment_path, l) is None:
                            continue
                        if corresponded_lines.get_parent_line(child_fragment_path, l) == parent_file_fragment["end_line"]:
                            parent_end_line = parent_file_fragment["end_line"]
                            break
                    if parent_end_line == -1:
                        continue
                    if (parent_start_line == parent_file_fragment["start_line"]) and (parent_end_line == parent_file_fragment["end_line"]):
                        if child_clone_id not in corresponded_fragments.keys():
                            corresponded_fragments[child_clone_id] = {}
                        corresponded_fragments[child_clone_id][index] = (parent_file_fragment["clone_id"], parent_file_fragment["index"])
                        break
                # 親コミットの方が行数が多いパターンは親コミットのコード片の先頭または末尾から行が削除されているので，子コミットの行番号を探す．
                if (parent_file_fragment["end_line"] - parent_file_fragment["start_line"] + 1) > (child_end_line - child_start_line + 1):
                    predict_child_start_line = -1
                    for l in range(parent_file_fragment["start_line"], parent_file_fragment["end_line"]+1):
                        if corresponded_lines.is_line_deleted(parent_fragment_path, l):
                            continue
                        else:
                            predict_child_start_line = l
                            break
                    if predict_child_start_line == -1:
                        continue
                    predict_child_end_line = -1
                    for l in reversed(range(parent_file_fragment["start_line"], parent_file_fragment["end_line"]+1)):
                        if corresponded_lines.is_line_deleted(parent_fragment_path, l):
                            continue
                        else:
                            predict_child_end_line = l
                            break
                    if predict_child_end_line == -1:
                        continue
                    if (predict_child_start_line == child_start_line) and (predict_child_end_line == child_end_line):
                        if child_clone_id not in corresponded_fragments.keys():
                            corresponded_fragments[child_clone_id] = {}
                        corresponded_fragments[child_clone_id][index] = (parent_file_fragment["clone_id"], parent_file_fragment["index"])
                        break
            if child_clone_id not in corresponded_fragments.keys():
                corresponded_fragments[child_clone_id] = {}
                corresponded_fragments[child_clone_id][index] = None
            else: 
                if index not in corresponded_fragments[child_clone_id].keys():
                    corresponded_fragments[child_clone_id][index] = None
    return corresponded_fragments
```